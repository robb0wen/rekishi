!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((t=t||self).rekishi={})}(this,(function(t){"use strict";const a=t=>"/"==t?t:t.replace(/\/$/g,""),e=t=>{if("string"!=typeof t||!t)throw new Error("Value passed must be a string");let e;e="/"==t.substr(0,1)?t:"?"==t.substr(0,1)?`${window.location.pathname.replace(/\/$/,"")}/${t}`:"#"==t.substr(0,1)?window.location.pathname+window.location.search+t:`${window.location.pathname.replace(/\/$/,"")}/${t}`;let[s,h]=e.split("#"),[i,r]=s.split("?");const n=r?r.split("&").reduce((t,a)=>{const[e,s]=a.split("=");return{...t,[e]:s}},{}):{};return{path:a(i),hash:h?"#"+h:null,params:n}},s=t=>{try{let a="*"!=t.substr(-1),e=t.replace(/(\*)|(\/)$/g,"");return a?new RegExp(`^${e}(\\/)?$`):new RegExp("^"+e)}catch(t){throw new Error("Path is not in the correct format")}};t.REKISHI_HASH="HASH",t.REKISHI_HASHPARAMS="HASHPARAMS",t.REKISHI_NOCHANGE="NOCHANGE",t.REKISHI_PARAMS="PARAMS",t.REKISHI_POP="POP",t.REKISHI_PUSH="PUSH",t.Rekishi=class{constructor(t){const a={initPathData:{},registeredPaths:[],scrollRestoration:"manual",...t};history.scrollRestoration=a.scrollRestoration,this._callbacks=[],this._prevURL={},this._currentURL={},this._pathData={},this._registeredPaths=[],this.push=this.push.bind(this),this.registerPath=this.registerPath.bind(this),this.getCurrentState=this.getCurrentState.bind(this),this.watch=this.watch.bind(this),this.unwatch=this.unwatch.bind(this),this._handlePop=this._handlePop.bind(this),this._updatePathData=this._updatePathData.bind(this),this._updatePosition=this._updatePosition.bind(this),this._didHashChange=this._didHashChange.bind(this),this._mergeRegisteredData=this._mergeRegisteredData.bind(this),a.registeredPaths.length&&a.registeredPaths.forEach(t=>{const{path:a,data:e}=t;this.registerPath(a,e)});const s=`${window.location.pathname}${window.location.hash}${window.location.search}`,{path:h,hash:i,params:r}=e(s);this._updatePosition(h,i,r),this._updatePathData(h,a.initPathData),window.addEventListener("popstate",this._handlePop)}_updatePosition(t,e,s){if(this._prevURL=this._currentURL,this._currentURL={path:a(t),hash:e,params:s},this._prevURL.path==this._currentURL.path){if(this._didHashChange()&&!this._didParamsChange())return"HASH";if(!this._didHashChange()&&this._didParamsChange())return"PARAMS";if(this._didHashChange()&&this._didParamsChange())return"HASHPARAMS";if(!this._didHashChange()&&!this._didParamsChange())return"NOCHANGE"}}_updatePathData(t,e){const s=a(t);return this._pathData={...this._pathData,[s]:e},this._pathData}_mergeRegisteredData(t){return{...this._registeredPaths.reduce((a,e)=>e.regex.test(t)?{...a,...e.data}:a,{}),...this._pathData[t]}}push(t,a){const{path:s,hash:h,params:i}=e(t);this._updatePathData(s,a||{});let r=this._updatePosition(s,h,i);r=r||"PUSH",history.pushState(null,null,t),this._callbacks.forEach(t=>t({...this.getCurrentState(),action:r}))}_handlePop(t){const a=`${window.location.pathname}${window.location.search}${window.location.hash}`,{path:s,hash:h,params:i}=e(a);let r=this._updatePosition(s,h,i);r=r||"POP",this._callbacks.forEach(t=>t({...this.getCurrentState(),action:r}))}_didHashChange(){return this._currentURL.path==this._prevURL.path&&this._currentURL.hash!=this._prevURL.hash}_didParamsChange(){return this._currentURL.path==this._prevURL.path&&(t=this._currentURL.params,a=this._prevURL.params,!(Object.keys(t).every(e=>e in a&&t[e]===a[e])&&Object.keys(a).every(e=>e in t&&t[e]===a[e])));var t,a}getCurrentState(){return{incoming:{path:this._currentURL.path,hash:this._currentURL.hash,params:this._currentURL.params,data:this._mergeRegisteredData(this._currentURL.path)},outgoing:{path:this._prevURL.path,hash:this._prevURL.hash,params:this._prevURL.params,data:this._mergeRegisteredData(this._prevURL.path)}}}registerPath(t,a){return this._registeredPaths=[...this._registeredPaths,{path:t,regex:s(t),data:a}],this._registeredPaths}watch(t){if("function"!=typeof t)throw new Error("Value passed to Watch is not a function");this._callbacks.push(t)}unwatch(t){if("function"!=typeof t)throw new Error("The value passed to unwatch is not a function");this._callbacks=this._callbacks.filter(a=>a!==t)}},Object.defineProperty(t,"__esModule",{value:!0})}));
