!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).rekishi={})}(this,(function(t){"use strict";function e(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],a=!0,n=!1,i=void 0;try{for(var s,h=t[Symbol.iterator]();!(a=(s=h.next()).done)&&(r.push(s.value),!e||r.length!==e);a=!0);}catch(t){n=!0,i=t}finally{try{a||null==h.return||h.return()}finally{if(n)throw i}}return r}(t,e)||h(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){if(t){if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}var c=function(t){return"/"==t?t:t.replace(/\/$/g,"")},u=function(t){if("string"!=typeof t||!t)throw new Error("Value passed must be a string");var e=i(("/"==t.substr(0,1)?t:"?"==t.substr(0,1)?"".concat(window.location.pathname.replace(/\/$/,""),"/").concat(t):"#"==t.substr(0,1)?window.location.pathname+window.location.search+t:"".concat(window.location.pathname.replace(/\/$/,""),"/").concat(t)).split("#"),2),a=e[0],s=e[1],h=i(a.split("?"),2),o=h[0],u=h[1],p=u?u.split("&").reduce((function(t,e){var a=i(e.split("="),2);return n({},t,r({},a[0],a[1]))}),{}):{};return{path:c(o),hash:s?"#".concat(s):null,params:p}},p=function(t){try{var e="*"!=t.substr(-1),r=t.replace(/(\*)|(\/)$/g,"");return e?new RegExp("^".concat(r,"(\\/)?$")):new RegExp("^".concat(r))}catch(t){throw new Error("Path is not in the correct format")}},l=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var a=n({},{initPathData:{},registeredPaths:[],scrollRestoration:"manual"},{},e);history.scrollRestoration=a.scrollRestoration,this._callbacks=[],this._prevURL={},this._currentURL={},this._pathData={},this._registeredPaths=[],this.push=this.push.bind(this),this.registerPath=this.registerPath.bind(this),this.getCurrentState=this.getCurrentState.bind(this),this.watch=this.watch.bind(this),this.unwatch=this.unwatch.bind(this),this._handlePop=this._handlePop.bind(this),this._updatePathData=this._updatePathData.bind(this),this._updatePosition=this._updatePosition.bind(this),this._didHashChange=this._didHashChange.bind(this),this._mergeRegisteredData=this._mergeRegisteredData.bind(this),a.registeredPaths.length&&a.registeredPaths.forEach((function(t){var e=t.path,a=t.data;r.registerPath(e,a)}));var i="".concat(window.location.pathname).concat(window.location.hash).concat(window.location.search),s=u(i),h=s.path,o=s.hash,c=s.params;this._updatePosition(h,o,c),this._updatePathData(h,a.initPathData),window.addEventListener("popstate",this._handlePop)}var a,i,h;return a=t,(i=[{key:"_updatePosition",value:function(t,e,r){if(this._prevURL=this._currentURL,this._currentURL={path:c(t),hash:e,params:r},this._prevURL.path==this._currentURL.path){if(this._didHashChange()&&!this._didParamsChange())return"HASH";if(!this._didHashChange()&&this._didParamsChange())return"PARAMS";if(this._didHashChange()&&this._didParamsChange())return"HASHPARAMS";if(!this._didHashChange()&&!this._didParamsChange())return"NOCHANGE"}}},{key:"_updatePathData",value:function(t,e){var a=c(t);return this._pathData=n({},this._pathData,r({},a,e)),this._pathData}},{key:"_mergeRegisteredData",value:function(t){var e=this._registeredPaths.reduce((function(e,r){return r.regex.test(t)?n({},e,{},r.data):e}),{});return n({},e,{},this._pathData[t])}},{key:"push",value:function(t,e){var r=this,a=u(t),i=a.path,s=a.hash,h=a.params;this._updatePathData(i,e||{});var o=this._updatePosition(i,s,h);o=o||"PUSH",history.pushState(null,null,t),this._callbacks.forEach((function(t){return t(n({},r.getCurrentState(),{action:o}))}))}},{key:"_handlePop",value:function(t){var e=this,r="".concat(window.location.pathname).concat(window.location.search).concat(window.location.hash),a=u(r),i=a.path,s=a.hash,h=a.params,o=this._updatePosition(i,s,h);o=o||"POP",this._callbacks.forEach((function(t){return t(n({},e.getCurrentState(),{action:o}))}))}},{key:"_didHashChange",value:function(){return this._currentURL.path==this._prevURL.path&&this._currentURL.hash!=this._prevURL.hash}},{key:"_didParamsChange",value:function(){return this._currentURL.path==this._prevURL.path&&(t=this._currentURL.params,e=this._prevURL.params,!(Object.keys(t).every((function(r){return r in e&&t[r]===e[r]}))&&Object.keys(e).every((function(r){return r in t&&t[r]===e[r]}))));var t,e}},{key:"getCurrentState",value:function(){return{incoming:{path:this._currentURL.path,hash:this._currentURL.hash,params:this._currentURL.params,data:this._mergeRegisteredData(this._currentURL.path)},outgoing:{path:this._prevURL.path,hash:this._prevURL.hash,params:this._prevURL.params,data:this._mergeRegisteredData(this._prevURL.path)}}}},{key:"registerPath",value:function(t,e){return this._registeredPaths=[].concat(s(this._registeredPaths),[{path:t,regex:p(t),data:e}]),this._registeredPaths}},{key:"watch",value:function(t){if("function"!=typeof t)throw new Error("Value passed to Watch is not a function");this._callbacks.push(t)}},{key:"unwatch",value:function(t){if("function"!=typeof t)throw new Error("The value passed to unwatch is not a function");this._callbacks=this._callbacks.filter((function(e){return e!==t}))}}])&&e(a.prototype,i),h&&e(a,h),t}();t.REKISHI_HASH="HASH",t.REKISHI_HASHPARAMS="HASHPARAMS",t.REKISHI_NOCHANGE="NOCHANGE",t.REKISHI_PARAMS="PARAMS",t.REKISHI_POP="POP",t.REKISHI_PUSH="PUSH",t.Rekishi=l,Object.defineProperty(t,"__esModule",{value:!0})}));
